<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Resilient GA4 Loader</title>

  <!-- 1. Load GA4 Library -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZC93LJZLLF"></script>
  <script>
    // 2. Initialize dataLayer & gtag stub
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());

    // 3. Robust loader with retry logic
    (function robustGA4(){
      const maxRetries = 10;
      const retryDelay = 500; // milliseconds
      let attempts = 0;

      function firePageView() {
        gtag('event', 'page_view', {
          page_location: window.location.href,
          page_path: window.location.pathname + window.location.search,
          page_title: document.title
        });
      }

      function checkGtag() {
        if (typeof gtag === 'function') {
          firePageView();
        } else if (attempts < maxRetries) {
          attempts++;
          setTimeout(checkGtag, retryDelay);
        } else {
          console.warn('GA4 loader: max retries reached, page_view not sent');
        }
      }

      // Trigger on initial DOM ready
      window.addEventListener('DOMContentLoaded', checkGtag);

      // Re-trigger when restoring from back/forward cache
      window.addEventListener('pageshow', event => {
        if (event.persisted) checkGtag();
      });
    })();
  </script>
</head>
<body>
  <h1>Welcome to My Manuscripts</h1>
  <p>Tracking your visit... Redirecting shortly.</p>

  <!-- 4. Simple redirect after tracking -->
  <script>
    setTimeout(() => {
      window.location.href = "https://roberthalls-manuscripts.com/";
    }, 3000);
  </script>
</body>
</html>
